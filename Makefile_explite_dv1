C = gcc
CXX = g++
CXXFLAGS = -pthread -std=c++11 -march=native
INCLUDES = -I./src -I./src/dv1 -I./src/dv1/reader -I./src/dv1/builder -I./src/ds_common/src -I./src/allflic48/src -I/opt/homebrew/Cellar/duckdb/1.4.0/include -L/opt/homebrew/Cellar/duckdb/1.4.0/lib
L_FLAGS = -lsqlite3 -lduckdb
#-lsnappy -llz4 -lbrotlienc -lbrotlidec -lz -lsqlite3 -lzstd -lcds
M_FLAGS = -mbmi2 -mpopcnt

opt: CXXFLAGS += -g -O2 -funroll-loops -DNDEBUG
opt: export_sqlite

debug: CXXFLAGS += -g -O0 -fno-inline
debug: export_sqlite

asan: CXXFLAGS += -fno-inline -O0 -g -fsanitize=undefined,address -fno-omit-frame-pointer -fsanitize-address-use-after-scope
asan: export_sqlite

release: CXXFLAGS += -O3 -fno-inline
release: export_sqlite

clean:
	rm export_sqlite
	rm -rf export_sqlite.dSYM

export_sqlite: src/export_sqlite_dv1.cpp src/dv1/common.hpp src/dv1/reader/*.hpp src/dv1/builder/*.hpp ./src/leopard-trie/src/leopard.hpp ./src/ds_common/src/*.hpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) src/export_sqlite_dv1.cpp -o export_sqlite $(L_FLAGS)
